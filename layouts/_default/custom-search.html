{{- define "main" -}}
<header class="page-header">
    <h1>{{ .Title }}</h1>
</header>

<div id="searchbox">
    <input id="searchInput" autofocus placeholder="{{ .Params.placeholder | default "検索ワードを入力..." }}" aria-label="search" type="search">
    <ul id="searchResults" aria-label="search results"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

<script>
window.addEventListener('DOMContentLoaded', () => {
    let fuse;
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');

    // 1. index.json を取得
    fetch('../index.json')
        .then(response => response.json())
        .then(data => {
            const options = {
                keys: ['title', 'summary', 'content'],
                threshold: 0.4
            };
            fuse = new Fuse(data, options);
        });

    // 2. 入力イベントを監視して表示を更新
    searchInput.addEventListener('input', () => {
        const query = searchInput.value;
        const results = fuse.search(query);

        if (results.length === 0) {
            searchResults.innerHTML = '';
            return;
        }

        // トップページの list.html の見た目を再現
        searchResults.innerHTML = results.map(result => {
            const item = result.item;
            return `
                <article class="post-entry">
                    ${item.image ? `
                    <figure class="entry-cover">
                        <img src="${item.image}" alt="${item.title}" style="width:100%; height:auto; border-radius:8px;">
                    </figure>` : ''}
                    <header class="entry-header">
                        <h2>${item.title}</h2>
                    </header>
                    <div class="entry-content">
                        <p>${item.summary}</p>
                    </div>
                    <a class="entry-link" href="${item.permalink}"></a>
                </article>
            `;
        }).join('');
    });
});
</script>

<style>
/* 見た目を整える最小限のCSS */
#searchResults { list-style: none; padding: 0; }
.post-entry {
    position: relative;
    margin-bottom: 20px;
    padding: 20px;
    background: var(--entry);
    border-radius: var(--radius);
    border: 1px solid var(--border);
}
.entry-header h2 { font-size: 1.5rem; margin: 10px 0; }
.entry-content { font-size: 0.9rem; color: var(--secondary); }
.entry-link {
    position: absolute;
    left: 0; right: 0; top: 0; bottom: 0;
    z-index: 1;
}
</style>
{{- end -}}
