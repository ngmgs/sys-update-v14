{{- define "main" }}
<header class="page-header">
    <h1>{{ .Title }}</h1>
</header>

<div id="my-search-container">
    <input id="mySearchInput" autofocus 
           placeholder="{{ .Params.placeholder | default "検索..." }}" 
           aria-label="search" type="search" autocomplete="off" 
           style="width: 100%; padding: 15px; font-size: 1.2rem; border-radius: 8px; border: 1px solid var(--border); background: var(--entry); color: var(--primary);">
    <ul id="mySearchResults" style="list-style: none; padding: 0; margin-top: 20px;"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

<script>
window.addEventListener('load', () => {
    let fuse;
    const input = document.getElementById('mySearchInput');
    const list = document.getElementById('mySearchResults');

    // 1. データの読み込み
    fetch('../index.json')
        .then(res => res.json())
        .then(data => {
            const cleanData = data.filter(item => item.title);
            fuse = new Fuse(cleanData, {
                keys: ['title', 'summary'],
                threshold: 0.4
            });
        });

    // 2. 検索処理
    input.addEventListener('input', () => {
        const query = input.value.trim();
        if (!query) {
            list.innerHTML = '';
            return;
        }

        const results = fuse.search(query);
        list.innerHTML = results.map(result => {
            const item = result.item;
            return `
                <li style="position: relative; margin-bottom: 20px; padding: 15px; background: var(--entry); border-radius: 8px; border: 1px solid var(--border); display: flex; align-items: center;">
                    ${item.image ? `<img src="${item.image}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 4px; margin-right: 15px;">` : ''}
                    <div>
                        <h3 style="margin: 0 0 5px 0; font-size: 1.1rem;">${item.title}</h3>
                        <p style="margin: 0; font-size: 0.85rem; color: var(--secondary);">${item.summary}</p>
                    </div>
                    <a href="${item.permalink}" style="position: absolute; inset: 0; z-index: 1;"></a>
                </li>
            `;
        }).join('');
    });
});
</script>
{{- end }}