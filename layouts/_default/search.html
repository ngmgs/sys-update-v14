{{- define "main" }}
<header class="page-header">
    <h1>{{ .Title }}</h1>
</header>

<div id="searchbox">
    <input id="searchInput" autofocus placeholder="検索..." aria-label="search" type="search" autocomplete="off">
    <ul id="searchResults" aria-label="search results"></ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

<script>
    let fuse;
    const resList = document.getElementById('searchResults');
    const sInput = document.getElementById('searchInput');

    // 1. 軽量化した index.json を読み込む
    window.onload = function () {
        fetch("../index.json")
            .then(response => response.json())
            .then(data => {
                const options = {
                    distance: 100,
                    threshold: 0.4,
                    keys: ['title', 'summary'] // contentは削除したのでこれだけでOK
                };
                fuse = new Fuse(data, options);
            });
    };

    // 2. 検索実行（画像付きHTMLを組み立てる）
    sInput.onkeyup = function () {
        if (fuse) {
            const results = fuse.search(this.value.trim());
            if (results.length !== 0) {
                let resultSet = '';
                for (let i in results) {
                    const item = results[i].item;
                    // ここでトップページ(list.html)の見た目を再現！
                    resultSet += `
                        <li class="post-entry">
                            ${item.image ? `<figure class="entry-cover"><img src="${item.image}" alt="${item.title}" style="width:120px; height:auto; border-radius:8px; float:left; margin-right:15px;"></figure>` : ''}
                            <header class="entry-header"><h2>${item.title}</h2></header>
                            <div class="entry-content"><p style="font-size:0.8em; color:gray;">${item.summary}</p></div>
                            <a href="${item.permalink}" aria-label="${item.title}" style="position:absolute; inset:0;"></a>
                            <div style="clear:both;"></div>
                        </li>`;
                }
                resList.innerHTML = resultSet;
            } else {
                resList.innerHTML = '';
            }
        }
    };
</script>

<style>
/* リストをカード風にする最小限の調整 */
.post-entry {
    position: relative;
    list-style: none;
    margin-bottom: 20px;
    padding: 15px;
    background: var(--entry);
    border-radius: var(--radius);
    border: 1px solid var(--border);
    overflow: hidden;
}
.entry-header h2 { font-size: 1.2rem; margin: 0 0 5px 0; }
</style>
{{- end }}
